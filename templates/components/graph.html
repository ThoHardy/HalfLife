{% if stats %}
<section class="mb-10">
    <details class="glass rounded-2xl overflow-hidden group border-none">
        <summary
            class="flex items-center justify-between p-4 cursor-pointer list-none hover:bg-gray-700/50 transition-colors">
            <div class="flex items-center gap-3">
                <span class="text-purple-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </span>
                <h3 class="text-lg font-medium text-gray-100">Analysis</h3>
            </div>
            <span class="text-gray-500 group-open:rotate-180 transition-transform">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </span>
        </summary>

        <div class="p-6 pt-0 border-t border-gray-700/50">
            <h4 class="text-[10px] uppercase tracking-widest text-gray-500 mb-4 text-center mt-4">7-Day Energy Output
                (Total Stars)
            </h4>
            <div class="flex items-end justify-between h-32 gap-2 px-2">
                {% set graph_max = 20 %}
                {% for day in stats %}
                {% set percentage = ((day.total / graph_max) * 100) | int %}
                {% if percentage > 100 %}{% set percentage = 100 %}{% endif %}
                <div class="flex-1 flex flex-col items-center gap-2 group h-full">
                    <div class="flex-grow w-full flex flex-col justify-end">
                        <div class="w-full bg-blue-500 border border-blue-400/50 rounded-t-sm relative flex items-end justify-center hover:bg-blue-400 transition-all"
                            style="height: {{ percentage }}%;">
                            <span
                                class="absolute -top-5 opacity-0 group-hover:opacity-100 text-[10px] font-bold text-blue-400 transition-opacity whitespace-nowrap">
                                {{ day.total }}{% if day.total >= graph_max %}+{% endif %}
                            </span>
                        </div>
                    </div>
                    <span class="text-[9px] text-gray-600 font-mono">{{ day.day_name }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </details>
</section>
{% endif %}